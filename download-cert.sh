#!/bin/bash
echo "Downloading and extracting encoding keys..."
wget -O convertcert.sh "https://raw.githubusercontent.com/LLK/scratch-link/develop/Certificates/convert-certificates.sh" >/dev/null 2>&1
IV="$(grep "IV=" convertcert.sh|awk -F '"' '{ print $2 }')"
KEY="$(grep "KEY=" convertcert.sh|awk -F '"' '{ print $2 }')"
rm convertcert.sh
echo "Downloading Scratch Link..."
wget -O mac.zip https://downloads.scratch.mit.edu/link/mac.zip >/dev/null 2>&1
echo "Extracting app..."
7z x mac.zip >/dev/null 2>&1
rm mac.zip >/dev/null 2>&1
7z x scratch-lin*.pkg >/dev/null 2>&1
rm scratch-lin*.pkg >/dev/null 2>&1
7z x Payloa* >/dev/null 2>&1
rm Payloa* >/dev/null 2>&1
echo "Decoding private key..."
openssl enc -d -nosalt -p -aes-256-cbc -K "$KEY" -iv "$IV" -in Scratch\ Link.app/Contents/Resources/scratch-device-manager.pem.enc -out cert.pem >/dev/null 2>&1
rm -rf Scratch\ Link.app >/dev/null 2>&1
echo "Done. Key and certificate saved."
