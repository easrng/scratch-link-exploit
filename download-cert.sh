#!/bin/bash
echo "Downloading and extracting encoding keys..."
wget -O convertcert.sh "https://raw.githubusercontent.com/LLK/scratch-link/develop/Certificates/convert-certificates.sh"
IV="$(grep "IV=" convertcert.sh|awk -F '"' '{ print $2 }')"
KEY="$(grep "KEY=" convertcert.sh|awk -F '"' '{ print $2 }')"
rm convertcert.sh
echo "Downloading Scratch Link..."
wget -O mac.zip https://downloads.scratch.mit.edu/link/mac.zip
echo "Extracting app..."
7z x mac.zip
rm mac.zip
7z x scratch-lin*.pkg
rm scratch-lin*.pkg
7z x Payloa*
rm Payloa*
echo "Decoding private key..."
openssl enc -d -nosalt -p -aes-256-cbc -K "$KEY" -iv "$IV" -in Scratch\ Link.app/Contents/Resources/scratch-device-manager.pem.enc -out cert.pem
rm -rf Scratch\ Link.app
echo "Done. Key and certificate saved."
